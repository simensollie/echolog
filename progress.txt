## Codebase Patterns
- Use Textual framework for TUI (>=0.50.0) - imports from `textual.app`, `textual.containers`, `textual.widgets`
- TUI is separate module `echolog_tui.py`, imported lazily in `echolog.py` when `tui` action is used
- EchologRecorder class in `echolog.py` is the core recording engine - TUI should interact with this
- Tests run via `pytest` in the virtual environment
- Activate venv with `source .venv/bin/activate` before running commands

---

## 2026-01-11 - US-001
Thread: https://ampcode.com/threads/T-019bacfb-822c-775e-81d5-13ed4be60bee
- Implemented: Basic TUI application with Textual framework
- Files changed:
  - echolog_tui.py (new) - TUI module with Dashboard, StatusPanel, TimerPanel, ChunkPanel, InfoPanel, LogPanel
  - echolog.py (modified) - Added import and call to run_tui() for `tui` action
- Acceptance criteria met:
  - `echolog tui` launches the TUI application
  - TUI displays main dashboard on startup
  - Application exits cleanly with `q` key
  - Typecheck passes (Python imports work)
- **Learnings for future iterations:**
  - Textual uses CSS-like styling via DEFAULT_CSS class attributes
  - Bindings are defined via BINDINGS class attribute with Binding objects
  - Use compose() method to build widget tree, on_mount() for initialization
  - query_one() to find widgets by ID/class, update() to refresh labels
---

## 2026-01-11 - US-002
Thread: https://ampcode.com/threads/T-019bacfe-196f-755c-b49f-1407d0f6d8c9
- Implemented: Recording status display with real-time updates
- Files changed:
  - echolog_tui.py (modified) - Added recorder integration, StatusPanel CSS styling with status-idle/status-recording classes, periodic status polling via set_interval()
  - echolog.py (modified) - Pass recorder instance to run_tui()
- Acceptance criteria met:
  - Status panel shows "Idle" (○) when not recording
  - Status panel shows "Recording" (●) with green color when active
  - Session ID displayed when recording
  - Status updates immediately via 0.5s polling interval
  - Typecheck passes
- **Learnings for future iterations:**
  - Textual's set_interval() is ideal for periodic status polling
  - Track _last_status to avoid redundant UI updates
  - Use TYPE_CHECKING import guard for type hints to avoid circular imports
  - CSS classes can be dynamically added/removed via add_class()/remove_class()
---

## 2026-01-11 - US-003
Thread: https://ampcode.com/threads/T-019bad00-968e-73cb-9fd5-9cd645773e28
- Implemented: Elapsed time display with real-time updates
- Files changed:
  - echolog.py (modified) - Added `elapsed_seconds` field to `get_status()` method
  - echolog_tui.py (modified) - Added `_update_timer()` method with 1-second polling, reset timer to 00:00:00 when idle
- Acceptance criteria met:
  - Timer displays HH:MM:SS format
  - Timer updates every second during recording
  - Timer shows 00:00:00 when idle
  - Typecheck passes
- **Learnings for future iterations:**
  - `get_status()` is the interface for TUI to get recorder state - extend it for new features
  - `_recording_start_monotonic` is used to calculate elapsed time (monotonic clock)
  - Use separate polling intervals for different update frequencies (0.5s for status, 1s for timer)
---

## 2026-01-11 - US-004
Thread: https://ampcode.com/threads/T-019bad02-a916-77ce-9399-8c8462d65d59
- Implemented: Segment progress display with progress bar
- Files changed:
  - echolog.py (modified) - Added segment progress fields to `get_status()`: `segment_duration_seconds`, `segment_elapsed_seconds`, `segment_remaining_seconds`, `current_chunk_number`
  - echolog_tui.py (modified) - Added `SegmentPanel` widget with progress bar, chunk counter, and time remaining display
- Acceptance criteria met:
  - Progress bar shows time elapsed in current segment (█ filled, ░ empty)
  - Displays current chunk number (e.g., "Chunk 3/∞")
  - Shows time remaining until next chunk in MM:SS format
  - Progress resets when new chunk starts (via modulo calculation)
  - Typecheck passes
- **Learnings for future iterations:**
  - Segment progress calculated from elapsed_seconds % segment_duration
  - Use `_segment_duration_seconds` from EchologRecorder for accurate segment length
  - Progress bar rendering: calculate percentage, fill chars with █ and ░
---
