# Ralph Progress Log
Started: Sun Jan 11 11:34:02 PM CET 2026
---

## Codebase Patterns
- LogPanel stores entries as list[dict[str, str]] with keys: 'level', 'message', 'timestamp'
- Use Rich markup for text coloring in Labels (e.g., `[#ff4444 bold]text[/]`)
- TUI widgets need to be mounted in an app before query_one() can find children
- Tests for TUI should use `async with app.run_test() as pilot:` pattern
- Audio level monitoring via parec: capture raw audio with --format=s16le and compute peak dB
- VU meter uses normalized scale: -60 dB to 0 dB (full scale = 32767 for 16-bit audio)
- Conditional widget rendering: use `if condition:` before `yield Widget()` in compose(); check flag before query_one()
- CLI flags flow: CLI arg → run_tui(arg) → EchologTUI.__init__(arg) → Dashboard(arg) → compose() uses arg

---

## 2026-01-11 23:45 - US-002
Thread: https://ampcode.com/threads/$AMP_CURRENT_THREAD_ID
- **What was implemented:**
  - Fixed type annotations in LogPanel (log_entries and _session_log_entries are now list[dict[str, str]])
  - Added 4 new tests for LogPanel functionality:
    - test_log_panel_shows_last_five_entries_by_default
    - test_log_panel_updates_with_session_log_entries
    - test_log_panel_colors_errors_red
    - test_log_panel_colors_warnings_yellow
- **Files changed:**
  - echolog_tui.py (type annotation fixes in LogPanel)
  - tests/test_tui_commands.py (added LogPanel tests)
- **Learnings for future iterations:**
  - LogPanel was already fully implemented - only needed type annotation fixes
  - log_entries uses dict with 'level', 'message' keys (not plain strings)
  - Colors are applied via Rich markup in _update_display(): errors #ff4444, warnings #ffaa00
  - Tests must mount widgets in app context to query children
---

## 2026-01-12 00:15 - US-003
Thread: https://ampcode.com/threads/$AMP_CURRENT_THREAD_ID
- **What was implemented:**
  - Added VUMeterPanel widget to TUI (echolog_tui.py)
  - Added audio level monitoring to EchologRecorder using parec (echolog.py)
  - _start_audio_monitor() spawns background thread capturing audio at 8kHz
  - Peak level computed from s16le samples, converted to dB scale
  - VU meter displays bar graph with dB readout, disabled when not recording
  - Added 4 new tests for VU meter functionality
- **Files changed:**
  - echolog.py (added _audio_level_db, _start_audio_monitor, _stop_audio_monitor, get_audio_level_db)
  - echolog_tui.py (added VUMeterPanel widget, integrated into Dashboard)
  - tests/test_tui_commands.py (added VU meter tests)
- **Learnings for future iterations:**
  - parec captures raw audio from PulseAudio device; use --format=s16le for easy processing
  - dB conversion: 20 * log10(peak / 32767) for 16-bit signed audio
  - VUMeterPanel._enabled controls whether meter is active or shows disabled state
  - Dashboard layout: added #vu-row Container for VU meter between timer-row and main-row
---

## 2026-01-12 00:45 - US-004
Thread: https://ampcode.com/threads/$AMP_CURRENT_THREAD_ID
- **What was implemented:**
  - Added --no-meter CLI flag to echolog.py to optionally disable VU meter
  - Modified run_tui() to accept no_meter parameter
  - Modified EchologTUI.__init__() to accept and store no_meter parameter
  - Modified Dashboard to conditionally render VUMeterPanel based on no_meter flag
  - Modified _sync_recorder_status() and _sync_vu_meter() to skip VU updates when meter disabled
  - Added 3 new tests for no_meter functionality:
    - test_no_meter_flag_hides_vu_meter_panel
    - test_tui_works_without_meter
    - test_meter_shown_by_default
- **Files changed:**
  - echolog.py (added --no-meter argument, passed to run_tui)
  - echolog_tui.py (added no_meter param to Dashboard, EchologTUI, run_tui; conditional VU panel rendering)
  - tests/test_tui_commands.py (added 3 tests for --no-meter flag)
- **Learnings for future iterations:**
  - To conditionally render widgets in Textual: use `if condition:` in compose() before `yield Widget()`
  - When widget may not exist, check flag before calling query_one() to avoid NoMatches exception
  - Dashboard accepts constructor params for configuration options like no_meter
---
## 2026-01-12 00:41 - US-005
Thread: https://ampcode.com/threads/$AMP_CURRENT_THREAD_ID
- **What was implemented:**
  - Added warning color for time limit line when remaining time is under 5 minutes
  - Added test coverage for low time limit warning markup
- **Files changed:**
  - echolog_tui.py
  - tests/test_tui_commands.py
  - scripts/ralph/prd.json
- **Learnings for future iterations:**
  - InfoPanel can use Rich markup to highlight only the time limit line without coloring the entire panel
  - Pass time_limit_remaining_seconds through update_info() to enable threshold-based warnings
---
